Sonora.DF <- mutate(Sonora.DF, Casos.media.7d=round(rollmeanr(x=Casos.diarios, 7, fill = NA)),1)
Sonora.DF <- mutate(Sonora.DF, Decesos.media.7d=round(rollmeanr(x=Decesos.diarios,7, fill=NA)),1)
Sonora.DF <- mutate(Sonora.DF, Pruebas.diarias= Pruebas - lag(Pruebas, default = Pruebas[1]))
Sonora.DF <- mutate(Sonora.DF, Letalidad= round((Decesos / Confirmados)*100),2)
Sonora.dia <- filter(Sonora.DF,Fecha==as.Date("2020-07-16"))
view(Sonora.DF)
Sonora.DF <- read_csv("ST_SonoraInformesCOVID.csv",
col_types = cols(Fecha = col_date(format = "%d/%m/%Y")))
Sonora.DF <- mutate(Sonora.DF, Casos.diarios= Confirmados - lag(Confirmados, default = Confirmados[1]))
Sonora.DF <- mutate(Sonora.DF, Decesos.diarios= Decesos - lag(Decesos, default = Confirmados[1]))
Sonora.DF <- mutate(Sonora.DF, Casos.media.7d=round(rollmeanr(x=Casos.diarios, 7, fill = NA),1))
Sonora.DF <- mutate(Sonora.DF, Decesos.media.7d=round(rollmeanr(x=Decesos.diarios,7, fill=NA),1))
Sonora.DF <- mutate(Sonora.DF, Pruebas.diarias= Pruebas - lag(Pruebas, default = Pruebas[1]))
Sonora.DF <- mutate(Sonora.DF, Letalidad= round((Decesos / Confirmados)*100,2))
Sonora.dia <- filter(Sonora.DF,Fecha==as.Date("2020-07-16"))
view(Sonora.DF)
Sonora.DF <- read_csv("ST_SonoraInformesCOVID.csv",
col_types = cols(Fecha = col_date(format = "%d/%m/%Y")))
Sonora.DF <- mutate(Sonora.DF, Casos.diarios= Confirmados - lag(Confirmados, default = Confirmados[1]))
Sonora.DF <- mutate(Sonora.DF, Decesos.diarios= Decesos - lag(Decesos, default = Confirmados[1]))
Sonora.DF <- mutate(Sonora.DF, Casos.media.7d=round(rollmeanr(x=Casos.diarios, 7, fill = NA),1))
Sonora.DF <- mutate(Sonora.DF, Decesos.media.7d=round(rollmeanr(x=Decesos.diarios,7, fill=NA),1))
Sonora.DF <- mutate(Sonora.DF, Pruebas.diarias= Pruebas - lag(Pruebas, default = Pruebas[1]))
Sonora.DF <- mutate(Sonora.DF, Incidencia= round((Confirmados / 30.74745),2))
Sonora.DF <- mutate(Sonora.DF, Letalidad= round((Decesos / Confirmados)*100,2))
Sonora.DF <- mutate(Sonora.DF, Mortalidad= round((Decesos / 30.74745)*100,2))
Sonora.DF <- mutate(Sonora.DF, Positividad= round((Pruebas / Confirmados)*100,2))
Sonora.DF <- mutate(Sonora.DF, Gravedad= round((Graves / Hospitalizados)*100,1))
Sonora.dia <- filter(Sonora.DF,Fecha==as.Date("2020-07-16"))
view(Sonora.DF)
library(flexdashboard)
library(tidyverse)
library(extrafont)
library(scales)
library(plotly)
library(htmlwidgets)
library(showtext)
library(tint)
library(rgdal)
library(rgeos)
library(ggiraph)
library(miniUI)
library(units)
library(reactable)
library(zoo)
library(readr)
Casos <- read_csv("Casosdiarios.csv",
col_types = cols(CASOS = col_integer(),
CVEGEO = col_character(), Fecha = col_date(format = "%d/%m/%Y"),
MUNICIPIO = col_character(), NUEVOS = col_integer()),
locale = locale(encoding = "ISO-8859-1"))
casosacumdia <- filter(Casos,Fecha==Sys.Date())
casosacumdiaorder <- arrange(casosacumdia,CASOS, desc(MUNICIPIO))
casosacumdia2 <- mutate(casosacumdiaorder,id=CVEGEO)
casosmov <- filter(casosacumdia2,NUEVOS!=0)
Decesos <- read_csv("Decesosdiarios.csv",
col_types = cols(DECESOS = col_integer(),
CVEGEO = col_character(), Fecha = col_date(format = "%d/%m/%Y"),
MUNICIPIO = col_character(), NUEVOS = col_integer()),
locale = locale(encoding = "ISO-8859-1"))
decesosacumdia <- filter(Decesos,Fecha==Sys.Date())
decesosacumdiaorder <- arrange(decesosacumdia,DECESOS, desc(MUNICIPIO))
decesosacumdia2 <- mutate(decesosacumdiaorder,id=CVEGEO)
decesosacumdia3 <- rename(decesosacumdia2, NUEVOSD=NUEVOS)
decesosmov <- filter(decesosacumdia3,NUEVOSD!=0)
movtbl<-full_join(casosmov,decesosacumdia3)
movtbl<-full_join(movtbl,decesosmov)
write.csv(movtbl,'movtlb.csv')
capa_munison <- readOGR("Shapes", layer="MUNSON")
capa_son <- readOGR("Shapes", layer="ENTSON")
Sonora.DF <- read_csv("ST_SonoraInformesCOVID.csv",
col_types = cols(Fecha = col_date(format = "%d/%m/%Y")))
Sonora.DF <- mutate(Sonora.DF, Casos.media.7d=round(rollmeanr(x=Casos.diarios, 7, fill = NA)),1)
library(readr)
Casos <- read_csv("Casosdiarios.csv",
col_types = cols(CASOS = col_integer(),
CVEGEO = col_character(), Fecha = col_date(format = "%d/%m/%Y"),
MUNICIPIO = col_character(), NUEVOS = col_integer()),
locale = locale(encoding = "ISO-8859-1"))
casosacumdia <- filter(Casos,Fecha==Sys.Date())
casosacumdiaorder <- arrange(casosacumdia,CASOS, desc(MUNICIPIO))
casosacumdia2 <- mutate(casosacumdiaorder,id=CVEGEO)
casosmov <- filter(casosacumdia2,NUEVOS!=0)
Decesos <- read_csv("Decesosdiarios.csv",
col_types = cols(DECESOS = col_integer(),
CVEGEO = col_character(), Fecha = col_date(format = "%d/%m/%Y"),
MUNICIPIO = col_character(), NUEVOS = col_integer()),
locale = locale(encoding = "ISO-8859-1"))
decesosacumdia <- filter(Decesos,Fecha==Sys.Date())
decesosacumdiaorder <- arrange(decesosacumdia,DECESOS, desc(MUNICIPIO))
decesosacumdia2 <- mutate(decesosacumdiaorder,id=CVEGEO)
decesosacumdia3 <- rename(decesosacumdia2, NUEVOSD=NUEVOS)
decesosmov <- filter(decesosacumdia3,NUEVOSD!=0)
movtbl<-full_join(casosmov,decesosacumdia3)
movtbl<-full_join(movtbl,decesosmov)
write.csv(movtbl,'movtlb.csv')
CasosSon <- ggplot(Sonora.DF) +
geom_col(aes(x= Fecha, y= Casos.diarios), fill= "#58bcbc", color = "white") +
geom_line(aes(x= Fecha, y= Casos.media.7d), color= "#005155", linetype= "solid", size=1)+
scale_y_continuous(expand = c(0, 0)) +
scale_x_date(expand=c(0,0)) +
theme_minimal() +
theme(
legend.position = "none",
panel.background = element_rect(fill= "gray95"),
axis.text.y = element_text(family = "Lato", size = 5, color = "black"),
axis.text.x = element_text(family = "Lato", size = 5, color = "black"),axis.line = element_line(colour = "black"),
panel.grid.major.y = element_line(color="white"),
panel.grid.minor.y = element_line(color="white"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
axis.title = element_text(family = "Lato", size = 8)) +
labs(y = NULL, x = NULL)
capa_munison <- readOGR("Shapes", layer="MUNSON")
capa_son <- readOGR("Shapes", layer="ENTSON")
capa_munison_df <- fortify(capa_munison, region="CVEGEO")
capa_munison_casos<- inner_join(capa_munison_df, casosacumdia2, by="id")
capa_munison_casos <- mutate(capa_munison_casos, movimiento=if_else(NUEVOS>0,1,0))
capa_munison_df <- fortify(capa_munison, region="CVEGEO")
capa_munison_casos<- inner_join(capa_munison_df, casosacumdia2, by="id")
capa_munison_casos <- mutate(capa_munison_casos, movimiento=if_else(NUEVOS>0,1,0))
discrete <- c("0" = "#58bcbc", "1" = "#01787e")
Mapa_mov <- ggplot(capa_munison_casos, aes(map_id = id)) +
geom_polygon(data=capa_son, aes(x=long, y=lat, group=group),
fill="transparent", color="black", size=1) +
geom_polygon(data=capa_munison, aes(x=long, y=lat, group=group),
fill="gray90", color="white", size=0.3) +
geom_map_interactive(aes(fill = factor(movimiento), tooltip=capa_munison_casos$tooltip,data_id=id),color = "white",size=0.5, map = capa_munison_df) +
scale_fill_manual(values = discrete, breaks= c("0", "1"))+
theme_void() +
theme(plot.title = (element_text(family = "Lato Black", size = 15, color = "#01A2AC")), rect = element_rect(fill = "transparent"),
legend.position = "none",
plot.background = element_rect(fill = "transparent", color = NA),
legend.key.height = unit (2, "cm"), axis.text = element_blank(),
legend.text = element_text(family = "Lato Light", size = 6, color = "black"),
legend.title = element_blank(),
plot.caption = element_text(family = "Lato Light", size = 8, color = "gray50"),
axis.title = element_blank()) +
labs(axis = NULL, y = NULL, x = NULL, title  = NULL,  fill = NULL, caption = NULL)
ggsave("movimientos.png",Mapa_mov, bg = "transparent", height = 25.9, width = 25.9, units = "cm")
discrete <- c("0" = "#58bcbc", "1" = "#01787e")
Mapa_mov <- ggplot(capa_munison_casos, aes(map_id = id)) +
geom_polygon(data=capa_son, aes(x=long, y=lat, group=group),
fill="transparent", color="black", size=1) +
geom_polygon(data=capa_munison, aes(x=long, y=lat, group=group),
fill="gray90", color="white", size=0.3) +
geom_map_interactive(aes(fill = factor(movimiento), tooltip=capa_munison_casos$tooltip,data_id=id),color = "white",size=0.5, map = capa_munison_df) +
scale_fill_manual(values = discrete, breaks= c("0", "1"))+
theme_void() +
theme(plot.title = (element_text(family = "Lato Black", size = 15, color = "#01A2AC")), rect = element_rect(fill = "transparent"),
legend.position = "none",
plot.background = element_rect(fill = "transparent", color = NA),
legend.key.height = unit (2, "cm"), axis.text = element_blank(),
legend.text = element_text(family = "Lato Light", size = 6, color = "black"),
legend.title = element_blank(),
plot.caption = element_text(family = "Lato Light", size = 8, color = "gray50"),
axis.title = element_blank()) +
labs(axis = NULL, y = NULL, x = NULL, title  = NULL,  fill = NULL, caption = NULL)
ggsave("movimientos.png",Mapa_mov, bg = "transparent", height = 25.9, width = 25.9, units = "cm")
tooltip_css <- "background-color:#01787E; color:white;font-family: Lato, sans-serif;opacity: 0.25; padding:5px"
Casos_map_ani <- girafe(code = print(Mapa_casos),
options = list(opts_tooltip(css = tooltip_css)) )
library(flexdashboard)
library(tidyverse)
library(extrafont)
library(scales)
library(plotly)
library(htmlwidgets)
library(showtext)
library(tint)
library(rgdal)
library(rgeos)
library(ggiraph)
library(miniUI)
library(units)
library(reactable)
library(zoo)
Sonora.DF <- read_csv("ST_SonoraInformesCOVID.csv",
col_types = cols(Fecha = col_date(format = "%d/%m/%Y")))
Sonora.DF <- mutate(Sonora.DF, Casos.diarios= Confirmados - lag(Confirmados, default = Confirmados[1]))
Sonora.DF <- mutate(Sonora.DF, Decesos.diarios= Decesos - lag(Decesos, default = Confirmados[1]))
Sonora.DF <- mutate(Sonora.DF, Casos.media.7d=round(rollmeanr(x=Casos.diarios, 7, fill = NA),1))
Sonora.DF <- mutate(Sonora.DF, Decesos.media.7d=round(rollmeanr(x=Decesos.diarios,7, fill=NA),1))
Sonora.DF <- mutate(Sonora.DF, Pruebas.diarias= Pruebas - lag(Pruebas, default = Pruebas[1]))
Sonora.DF <- mutate(Sonora.DF, Incidencia= round((Confirmados / 30.74745),2))
Sonora.DF <- mutate(Sonora.DF, Letalidad= round((Decesos / Confirmados)*100,2))
Sonora.DF <- mutate(Sonora.DF, Mortalidad= round((Decesos / 30.74745)*100,2))
Sonora.DF <- mutate(Sonora.DF, Positividad= round((Pruebas / Confirmados)*100,2))
Sonora.DF <- mutate(Sonora.DF, Gravedad= round((Graves / Hospitalizados)*100,1))
Sonora.dia <- filter(Sonora.DF,Fecha==Sys.Date())
Casos <- read_csv("Casosdiarios.csv",
col_types = cols(CASOS = col_integer(),
CVEGEO = col_character(), Fecha = col_date(format = "%d/%m/%Y"),
MUNICIPIO = col_character(), NUEVOS = col_integer()),
locale = locale(encoding = "ISO-8859-1"))
casosacumdia <- filter(Casos,Fecha==Sys.Date())
casosacumdiaorder <- arrange(casosacumdia,CASOS, desc(MUNICIPIO))
casosacumdia2 <- mutate(casosacumdiaorder,id=CVEGEO)
Decesos <- read_csv("Decesosdiarios.csv",
col_types = cols(DECESOS = col_integer(),
CVEGEO = col_character(), Fecha = col_date(format = "%d/%m/%Y"),
MUNICIPIO = col_character(), NUEVOS = col_integer()),
locale = locale(encoding = "ISO-8859-1"))
decesosacumdia <- filter(Decesos,Fecha==Sys.Date())
decesosacumdiaorder <- arrange(decesosacumdia,DECESOS, desc(MUNICIPIO))
decesosacumdia2 <- mutate(decesosacumdiaorder,id=CVEGEO)
casos_s <- group_by(Casos, CVEGEO, MUNICIPIO)
casos_ult <- casos_s %>% filter(NUEVOS!=0) %>% arrange(desc(Fecha)) %>% slice(1)
casos_ult_dias <- mutate(casos_ult, Dias_ult=as.numeric(Sys.Date()-Fecha))
casos_ult_dias <- mutate(casos_ult_dias, clasfdias=if_else(Dias_ult>30,5, if_else(Dias_ult>14,4, if_else(Dias_ult>7,3,if_else(Dias_ult>0,2,1)))))
casos_ult_dias <- mutate(casos_ult_dias, clasfdias=as.numeric(clasfdias))
casos_ult_dias <- mutate(casos_ult_dias,id=CVEGEO)
CasosSonora = function(...) return(Sonora.dia$Confirmados)
DecesosSonora = function(...) return(Sonora.dia$Decesos)
HospSonora = function(...) return(Sonora.dia$Hospitalizados)
RecuperadosSonora = function(...) return(9402)
IncidenciaSonora= function(...) return(Sonora.dia$Incidencia)
LetalidadSonora= function(...) return(Sonora.dia$Letalidad)
GravedadSonora= function(...) return(Sonora.dia$Gravedad)
Recup100Sonora= function(...) return(67)
Casos = CasosSonora()
valueBox(Casos, icon = "fa-certificate", color = "#01787E")
Decesos = DecesosSonora()
valueBox(Decesos, icon= "fa-plus", color = "#993366")
Hospitalizados = HospSonora()
valueBox(  Hospitalizados, icon = "fa-hospital-o", color = "#F79646")
Recuperados = RecuperadosSonora()
valueBox( Recuperados, icon = "fa-arrow-circle-up", color = "#4F81BD")
CasosSon <- ggplot(Sonora.DF) +
geom_col(aes(x= Fecha, y= Casos.diarios), fill= "#58bcbc", color = "white") +
geom_line(aes(x= Fecha, y= Casos.media.7d), color= "#005155", linetype= "solid", size=1)+
scale_y_continuous(expand = c(0, 0)) +
scale_x_date(expand=c(0,0)) +
theme_minimal() +
theme(
legend.position = "none",
panel.background = element_rect(fill= "gray95"),
axis.text.y = element_text(family = "Lato", size = 10, color = "black"),
axis.text.x = element_text(family = "Lato", size = 10, color = "black"),axis.line = element_line(colour = "black"),
panel.grid.major.y = element_line(color="white"),
panel.grid.minor.y = element_line(color="white"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
axis.title = element_text(family = "Lato", size = 8)) +
labs(y = NULL, x = NULL)
ggplotly(CasosSon)
DecesosSon <- ggplot(Sonora.DF) +
geom_col(aes(x= Fecha, y= Decesos.diarios), fill= "#E0A3C1", color = "white") +
geom_line(aes(x= Fecha, y= Decesos.media.7d), color= "#4D1A33", linetype= "solid", size=1)+
scale_y_continuous(expand = c(0, 0)) +
scale_x_date(expand=c(0,0)) +
theme_minimal() +
theme(
legend.position = "none",
panel.background = element_rect(fill= "gray95"),
axis.text.y = element_text(family = "Lato", size = 10, color = "black"),
axis.text.x = element_text(family = "Lato", size = 10, color = "black"),axis.line = element_line(colour = "black"),
panel.grid.major.y = element_line(color="white"),
panel.grid.minor.y = element_line(color="white"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
axis.title = element_text(family = "Lato", size = 8)) +
labs(y = NULL, x = NULL)
ggplotly(DecesosSon)
RecupSon <- ggplot(Sonora.DF) +
geom_line(aes(x= Fecha, y= Pacientes_Curados ), color= "#366092", linetype= "solid", size=1)+
geom_line(aes(x= Fecha, y= Decesos ), color= "#73264D", linetype= "solid", size=1)+
scale_y_continuous(expand = c(0, 50)) +
scale_x_date(expand=c(0,0)) +
theme_minimal() +
theme(
legend.position = "top",
panel.background = element_rect(fill= "gray95"),
axis.text.y = element_text(family = "Lato", size = 10, color = "black"),
axis.text.x = element_text(family = "Lato", size = 10, color = "black"),axis.line = element_line(colour = "black"),
panel.grid.major.y = element_line(color="white"),
panel.grid.minor.y = element_line(color="white"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
axis.title = element_text(family = "Lato", size = 8)) +
labs(y = NULL, x = NULL)
ggplotly(RecupSon)
Pruebasdiarias <- ggplot(Sonora.DF) +
geom_col(aes(x= Fecha, y= Pruebas.diarias), fill= "#4BACC6", color = "white") +
scale_y_continuous(expand = c(0, 40)) +
scale_x_date(expand=c(0,0)) +
theme_minimal() +
theme(
legend.position = "none",
panel.background = element_rect(fill= "gray95"),
axis.text.y = element_text(family = "Lato", size = 10, color = "black"),
axis.text.x = element_text(family = "Lato", size = 10, color = "black"),axis.line = element_line(colour = "black"),
panel.grid.major.y = element_line(color="white"),
panel.grid.minor.y = element_line(color="white"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
axis.title = element_text(family = "Lato", size = 8)) +
labs(y = NULL, x = NULL)
ggplotly(Pruebasdiarias)
Gravgraf <- ggplot(Sonora.DF) +
geom_area(aes(x= Fecha, y= Hospitalizados), fill= "#FABF8F", color = "#E26B0A", size= 1, alpha=0.75) +
geom_area(aes(x= Fecha, y= Graves), fill= "#F79646") +
scale_y_continuous(expand = c(0, 40)) +
scale_x_date(expand=c(0,0)) +
theme_minimal() +
theme(
legend.position = "top",
panel.background = element_rect(fill= "gray95"),
axis.text.y = element_text(family = "Lato", size = 10, color = "black"),
axis.text.x = element_text(family = "Lato", size = 10, color = "black"),axis.line = element_line(colour = "black"),
panel.grid.major.y = element_line(color="white"),
panel.grid.minor.y = element_line(color="white"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
axis.title = element_text(family = "Lato", size = 8)) +
labs(y = NULL, x = NULL)
ggplotly(Gravgraf)
capa_munison <- readOGR("Shapes", layer="MUNSON")
capa_son <- readOGR("Shapes", layer="ENTSON")
capa_munison_df <- fortify(capa_munison, region="CVEGEO")
capa_munison_casos<- inner_join(capa_munison_df, casosacumdia2, by="id")
capa_munison_casos$tooltip <- c(paste0("<b>",capa_munison_casos$MUNICIPIO, "</b>", "<b>","\n Casos ", "</b>", capa_munison_casos$CASOS,"</b>", "<b>","\n Nuevos ", "</b>", capa_munison_casos$NUEVOS))
Mapa_casos <- ggplot(capa_munison_casos, aes(map_id = id)) +
geom_polygon(data=capa_son, aes(x=long, y=lat, group=group),
fill="transparent", color="black", size=1) +
geom_polygon(data=capa_munison, aes(x=long, y=lat, group=group),
fill="gray90", color="white", size=0.3) +
geom_map_interactive(aes(fill = CASOS, tooltip=capa_munison_casos$tooltip,data_id=id),color = "white",size=0.3, map = capa_munison_df) +
scale_fill_gradient(low = "#58BCBC", high = "black", limits = c(1,5700), breaks = c(1, 1000, 2000, 3000, 4000, 5000))+
theme_void() +
theme(plot.title = (element_text(family = "Lato Black", size = 15, color = "#01A2AC")),
legend.position = "left",
legend.key.height = unit (2, "cm"), axis.text = element_blank(),
legend.text = element_text(family = "Lato Light", size = 6, color = "black"),
legend.title = element_blank(),
plot.caption = element_text(family = "Lato Light", size = 8, color = "gray50"),
axis.title = element_blank()) +
labs(axis = NULL, y = NULL, x = NULL, title  = NULL,  fill = NULL, caption ="Elaboración Luis Armando Moreno con información de la Secretaría de Salud del Estado de Sonora")
tooltip_css <- "background-color:#01787E; color:white;font-family: Lato, sans-serif;opacity: 0.25; padding:5px"
Casos_map_ani <- girafe(code = print(Mapa_casos),
options = list(opts_tooltip(css = tooltip_css)) )
Casos_map_ani
CasosCol <- ggplot(casosacumdiaorder) +
geom_col(aes(x = fct_inorder(MUNICIPIO), y = `CASOS`, fill = `CASOS`), color = "white") +
geom_text(aes(x = fct_inorder(MUNICIPIO), y = `CASOS`, label=`CASOS`, family="Lato"), size=2, vjust=0.4, hjust=-0.4) +
geom_vline(xintercept=seq(1.5,length(unique(casosacumdiaorder$MUNICIPIO))-0.5, 1),lwd=0.2, colour="gray95") +
coord_flip(clip = "off") +
scale_fill_gradient(low = "#58BCBC", high = "black", limits = c(1,5700), breaks = c(1, 1000, 2000, 3000, 4000, 5000)) +
theme_minimal() +
theme(
legend.position = "none",
axis.text.y = element_text(family = "Lato", size = 5, color = "black"),
axis.text.x = element_blank(),axis.line.y = element_line(colour = "black"),
panel.background = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
axis.title = element_text(family = "Lato", size = 8),
plot.margin=unit(c(0,2,0,0),"cm")) +
labs(y = NULL, x = NULL)
CasosCol
capa_ult_dias<- inner_join(capa_munison_df, casos_ult_dias, by="id")
capa_ult_dias$tooltip <- c(paste0("<b>",capa_ult_dias$MUNICIPIO, "</b>", "<b>","\n Último caso ", "</b>", capa_ult_dias$Fecha,"</b>", "<b>","\n Días ", "</b>", capa_ult_dias$Dias_ult))
discreta <- c("1" = "#A04A69", "2" = "#ECA48E","3" = "#FECF7D","4" = "#0397A1", "5" = "#215968")
Mapa_ult <- ggplot(capa_ult_dias, aes(map_id = id)) +
geom_polygon(data=capa_son, aes(x=long, y=lat, group=group),
fill="transparent", color="black", size=1) +
geom_polygon(data=capa_munison, aes(x=long, y=lat, group=group),
fill="gray90", color="white", size=0.3) +
geom_map_interactive(aes(fill = factor(clasfdias), tooltip=capa_ult_dias$tooltip,data_id=id),color = "white",size=0.3, map = capa_munison_df) +
scale_fill_manual("Días desde que se \n confirmó el último caso", values = discreta, breaks= c("5", "4", "3", "2", "1"), labels = c( "+30", "15-30", "8-14","1-7", "0"))+
theme_void() +
theme(plot.title = (element_text(family = "Lato Black", size = 15, color = "#01A2AC")),
legend.position = "left", axis.text = element_blank(), legend.key.height = unit (2, "cm"),
legend.text = element_text(family = "Lato Light", size = 6, color = "black"),
legend.title = element_text(family = "Lato Black", size = 5, color = "black"),
plot.caption = element_text(family = "Lato Light", size = 8, color = "gray50"),
axis.title = element_blank()) +
labs(axis = NULL, y = NULL, x = NULL, title  = NULL,  fill = NULL, caption ="Elaboración Luis Armando Moreno con información de la Secretaría de Salud del Estado de Sonora", fill = "Días desde que se confirmó el último caso")
tooltip_css <- "background-color:#BFBFBF; color:black;font-family: Lato, sans-serif;opacity: 0.25; padding:5px"
hover_css <- "stroke:black;stroke-width:0.5pt;"
Casos_ult_ani <- girafe(code = {print(Mapa_ult)},
options = list(opts_tooltip(css = tooltip_css), opts_hover(hover_css)) )
Casos_ult_ani
casos_ult_dias_order <- arrange(casos_ult_dias,Dias_ult, desc(MUNICIPIO))
Casos_ultCol <- ggplot(casos_ult_dias_order) +
geom_col(aes(x = fct_inorder(MUNICIPIO), y = Dias_ult, fill = factor(clasfdias)), color = "white") +
geom_text(aes(x = fct_inorder(MUNICIPIO), y = Dias_ult, label=Dias_ult, family="Lato"), size=2, vjust=0.4, hjust=-0.4) +
geom_vline(xintercept=seq(1.5,length(unique(casosacumdiaorder$MUNICIPIO))-0.5, 1),lwd=0.2, colour="gray95") +
coord_flip(clip = "off") +
scale_fill_manual(values = discreta)+
theme_minimal() +
theme(
legend.position = "none",
axis.text.y = element_text(family = "Lato", size = 5, color = "black"),
axis.text.x = element_blank(),axis.line.y = element_line(colour = "black"),
panel.background = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
axis.title = element_text(family = "Lato", size = 8),
plot.margin=unit(c(0,2,0,0),"cm")) +
labs(y = NULL, x = NULL)
Casos_ultCol
capa_munison_decesos<- inner_join(capa_munison_df, decesosacumdia2, by="id")
capa_munison_decesos$tooltip <- c(paste0("<b>",capa_munison_decesos$MUNICIPIO, "</b>", "<b>","\n Decesos ", "</b>", capa_munison_decesos$DECESOS,"</b>", "<b>","\n Nuevos ", "</b>", capa_munison_decesos$NUEVOS))
Mapa_decesos <- ggplot(capa_munison_decesos, aes(map_id = id)) +
geom_polygon(data=capa_son, aes(x=long, y=lat, group=group),
fill="transparent", color="black", size= 1) +
geom_polygon(data=capa_munison, aes(x=long, y=lat, group=group),
fill="gray90", color="white", size=0.3) +
geom_map_interactive(aes(fill = DECESOS, tooltip=capa_munison_decesos$tooltip, data_id=id),color = "white",size=0.3, map = capa_munison_df) +
scale_fill_gradient(low= "#993366", high = "black", limits = c(1,390), breaks = c(1, 50, 100, 150, 200, 250,300,350))+
theme_void() +
theme(plot.title = (element_text(family = "Lato Black", size = 15, color = "#01A2AC")),
legend.position = "left",
legend.key.height = unit (2, "cm"), axis.text = element_blank(),
legend.text = element_text(family = "Lato Light", size = 6, color = "black"),
legend.title = element_blank(),
plot.caption = element_text(family = "Lato Light", size = 8, color = "gray50"),
axis.title = element_blank()) +
labs(axis = NULL, y = NULL, x = NULL, title  = NULL,  fill = NULL, caption ="Elaboración Luis Armando Moreno con información de la Secretaría de Salud del Estado de Sonora")
tooltip_css <- "background-color:#73264D; color:white;font-family: Lato, sans-serif;opacity: 0.25; padding:5px"
Decesos_map_ani <- girafe(code = print(Mapa_decesos),
options = list(opts_tooltip(css = tooltip_css)) )
Decesos_map_ani
DecesosCol <- ggplot(decesosacumdiaorder) +
geom_col(aes(x = fct_inorder(MUNICIPIO), y = `DECESOS`, fill = DECESOS), color = "white") +
geom_text(aes(x = fct_inorder(MUNICIPIO), y = `DECESOS`, label=DECESOS, family="Lato"), size=2, vjust=0.4, hjust=-0.4) +
geom_vline(xintercept=seq(1.5,length(unique(decesosacumdiaorder$MUNICIPIO))-0.5, 1),lwd=0.2, colour="gray95") +
coord_flip(clip = "off") +
scale_fill_gradient(low= "#993366", high = "black", limits = c(1,390), breaks = c(1, 50, 100, 150, 200, 250,300,350)) +
theme_minimal() +
theme(
legend.position = "none",
axis.text.y = element_text(family = "Lato Light", size = 8, color = "black"),
axis.text.x = element_blank(), axis.line.y = element_line(colour = "black"),
panel.background = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
axis.title = element_text(family = "Lato", size = 8),
plot.margin=unit(c(0,2,0,0),"cm")) +
labs(y = NULL, x = NULL)
DecesosCol
Casos <- read_csv("Casosdiarios.csv",
col_types = cols(CASOS = col_integer(),
CVEGEO = col_character(), Fecha = col_date(format = "%d/%m/%Y"),
MUNICIPIO = col_character(), NUEVOS = col_integer()),
locale = locale(encoding = "ISO-8859-1"))
casosacumdia <- filter(Casos,Fecha==Sys.Date())
casosacumdiaorder <- arrange(casosacumdia,CASOS, desc(MUNICIPIO))
casosacumdia2 <- mutate(casosacumdiaorder,id=CVEGEO)
Sonora.DF <- read_csv("ST_SonoraInformesCOVID.csv",
col_types = cols(Fecha = col_date(format = "%d/%m/%Y")))
Sonora.DF <- mutate(Sonora.DF, Casos.diarios= Confirmados - lag(Confirmados, default = Confirmados[1]))
Sonora.DF <- mutate(Sonora.DF, Decesos.diarios= Decesos - lag(Decesos, default = Confirmados[1]))
Sonora.DF <- mutate(Sonora.DF, Casos.media.7d=round(rollmeanr(x=Casos.diarios, 7, fill = NA),1))
Sonora.DF <- mutate(Sonora.DF, Decesos.media.7d=round(rollmeanr(x=Decesos.diarios,7, fill=NA),1))
Sonora.DF <- mutate(Sonora.DF, Pruebas.diarias= Pruebas - lag(Pruebas, default = Pruebas[1]))
Sonora.DF <- mutate(Sonora.DF, Incidencia= round((Confirmados / 30.74745),2))
Sonora.DF <- mutate(Sonora.DF, Letalidad= round((Decesos / Confirmados)*100,2))
Sonora.DF <- mutate(Sonora.DF, Mortalidad= round((Decesos / 30.74745)*100,2))
Sonora.DF <- mutate(Sonora.DF, Positividad= round((Pruebas / Confirmados)*100,2))
Sonora.DF <- mutate(Sonora.DF, Gravedad= round((Graves / Hospitalizados)*100,1))
Sonora.dia <- filter(Sonora.DF,Fecha==Sys.Date())
Casos$NUEVOS[Casos$NUEVOS == 0] <- NA
Casos_Todos <- ggplot(data = Casos) +
geom_tile(mapping = aes(x = Fecha, y = MUNICIPIO, fill = NUEVOS, text = paste(
"ACUMULADOS: ", CASOS, "\n")), color = "white") +
scale_fill_gradient(low = "#58BCBC", high = "black", limits = c(1,310), breaks = c(1, 50, 100, 150, 200, 250, 300)) +
scale_x_date(date_breaks = "weeks" , date_labels = "%d-%m") +
theme_minimal() +
theme(plot.title = (element_text(family = "Lato Black", size = 15, color = "#01A2AC")),
legend.key.height = unit (2, "cm"),    axis.text.y = element_text(family = "Lato Light", size = 9, color = "black"),
axis.text.x = element_text(family = "Lato Light", size = 8, color = "black"),
legend.text = element_text(family = "Lato", size = 8, color = "black"),
panel.background = element_rect(fill="gray99") ,
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
legend.title = element_text(family = "Lato", size = 8, color = "black"),
plot.caption = element_text(family = "Lato Light", size = 8, color = "gray50", face = "italic"),
axis.title = element_text(family = "Lato", size = 8)) +
labs(y = NULL, x = NULL, title  = NULL,  fill = NULL, caption ="Elaboración propia con información de la Secretaría de Salud del Estado de Sonora")
Casos_anim <- ggplotly(Casos_Todos)
Casos_anim
library(flexdashboard)
library(tidyverse)
library(extrafont)
library(scales)
library(plotly)
library(htmlwidgets)
library(showtext)
library(tint)
library(rgdal)
library(rgeos)
library(ggiraph)
library(miniUI)
library(units)
library(reactable)
library(zoo)
Casos <- read_csv("Casosdiarios.csv",
col_types = cols(CASOS = col_integer(),
CVEGEO = col_character(), Fecha = col_date(format = "%d/%m/%Y"),
MUNICIPIO = col_character(), NUEVOS = col_integer()),
locale = locale(encoding = "ISO-8859-1"))
casosacumdia <- filter(Casos,Fecha==Sys.Date())
casosacumdiaorder <- arrange(casosacumdia,CASOS, desc(MUNICIPIO))
casosacumdia2 <- mutate(casosacumdiaorder,id=CVEGEO)
